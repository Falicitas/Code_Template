# Millar-Rabin&二次探测

利用费马小定理的逆定理来判定：如果一个数n，在$[2,n-1]$挑一个数a不满足$a^{n-1}\equiv 1(\% n)$，则n一定不是素数（当然满足了也不一定是素数）。

```cpp
bool millerRabin(int n) {
  if (n < 3) return n == 2;
  // test_time 为测试次数,建议设为不小于 8
  // 的整数以保证正确率,但也不宜过大,否则会影响效率
  for (int i = 1; i <= test_time; ++i) {
    int a = rand() % (n - 2) + 2;
    if (quickPow(a, n - 1, n) != 1) return 0;
  }
  return 1;
}
```

## 卡迈克尔数

定义：对于一个合数n，所有与n互质的基数a都满足$a^{n-1}\equiv 1(\%n)$，则称$n$为卡迈克尔数，或者费马伪素数。

比如$561 = 3 * 11 * 17$，如果没有随机到$3\ or\ 11\ or\ 17$，检测结果就错误了。

### 性质

若$n$是卡迈克尔数，$m=2^{n}-1$也是卡迈克尔数，即卡迈克尔数有无穷个。

## 二次探测定理

如果 $p$ 是奇素数, 则 $x^{2} \equiv 1 \bmod p$ 的解为 $x=1$ 或者 $x=p-1(\bmod p)$

证明：移项分解$:(x-1)(x+1)\equiv 0(\%p)\Rightarrow x=1\ or\ x=p-1$

根据费马小定理，选一个基数$x$满足$(x,p)=1$，则有$x^{p-1}\equiv 1(\%p),p>=2$（p=2的时候特判一下，由于p-1不能分解成奇素数）。根据上面的原理，若p-1能被2整除，那么$x^{\frac{p-1}{2}}$要不等于$1\ or\ p-1$，如果不等于这两个数，则p不是奇素数。当$x^{\frac{p-1}{2}}\equiv 1(\%p)$，则可继续往下侦测，直至指数不能被2整除。

代码实现一般反着来，现将$n-1$除至$b*2^k$中的b，根据$x^{b*2^i}=x^{b*2^{i-1}}*x^{b*2^{i-1}}$对$x^{b*2^i}$是否等于$1\ or\ n-1$做检测。

至于模奇素数时为何对于底数开根一直会有=1 or = p-1的特性而非素数没有，这就不太清楚了。

