# 康托/逆康托展开（Cantor expansion）

将排列与自然数建立双射关系。

## 康托展开

定义长度为$n$的排列集中$1,2,\dots,n$编号为0。此时对于排列$P_1,P_2,\dots,P_n$的编号为$a_1 (n-1)! + a_2(n-2)!\dots a_n(0)!$，其中$a_i$为 **现存可取数中比$P_i$小的数的个数** 。

> 比如$4,2,3,1$：
>
> 1. 当前可取数为{1,2,3,4}。比4小的有3个，则编号$+3*(4-1)! = 18$。去掉4。
> 2. 当前可取数为{1,2,3}。比2小的有1个，则编号$+1*2! = 2$。去掉2。
> 3. 当前可取数为{1,3}。比3小的有1个，则编号$+1*1! = 1$。去掉3。
> 4. 当前可取数为{1}。比1小的有0个，则编号$+0*0! = 0$。故当前排列编号为21。
>
> 通俗来说就是在可取的数集里存在比当前的数小的数，则让该数处在该位，后面任意排列都比当前排列的字典序小。按位统计即可。

由于每次都是统计比自己数小的存在的数，故用BIT优化就能达到$O(n\log n)$。

## 逆康托展开

很简单，逆着来就行了。

把数顺序扔进平衡树里。比如当前确定第i个数，将编号除$(n-i)!$，商+1（记作第j大）则为当前该确定的数，余数则用来确定后面的数。每次确定完后，要从平衡树里删掉第j大的数。复杂度$O(n\log n)$。