# 树上完美匹配

树上完美匹配指的是树上每一个点都属于一个点对，且点对间不交叉。

树上完美匹配定理：当一棵树存在完美匹配，有且仅有一种完美匹配。

> 可以用归纳法证明。对于该树的度数为 1 的点，仅能与其父节点配对。此时转化成更小的图 G'。由于假设图 G' 完美配对唯一，可推得 G 完美配对唯一。

## 完美匹配的存在判别

每次都从叶子结点开始匹配。不过该处理比较麻烦。另外的有，随意以某点为根，遍历过程中将点压入栈中。此时从后往前遍历可保证匹配均从叶子节点开始。接下来开始匹配节点：当遍历到节点 $u$​ ，令 `siz[fa[u]]+=siz[u]&1`。在给父节点加值前判断该节点 `siz[u]` 是否大于 2。这个巧妙的匹配方式保证了当父节点可以和子树剩余节点完美匹配时，父节点的 `siz[]=2`。对于更上层的节点，相当于该分支被“屏蔽”了。此时等价于更小的子图的匹配问题。

故树上匹配可以利用好位运算。