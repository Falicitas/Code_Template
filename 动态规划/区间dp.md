# 区间dp

## 一些习题

### 区间k重覆盖问题

一条直线上有 $n$ 个闭区间$[L_i,R_i]$，每个区间长度为$Len_i = R_i - L_i + 1$。现在需要挑选若干个区间，使直线被覆盖的长度最大，同时满足：任意的区间点被覆盖不超过 $k$ 次。一个区间点被覆盖若干次贡献仅算 $1$ 。给定 $n$ 个区间及 $k$ ，求解最大覆盖长度。

数据范围： $1\leq n\leq 500,1\leq k \leq 3,1\leq L_i,R_i \leq 1e9$ 。

大概的想法是dp。（感觉不太会建网络流的图。。）

先定义几个东西：区间集合为 $U$ ，以 $[1,i]$ 为左端点的集合为 $T_i$ 。单个区间记作 $u$ 。

具体地，首先给区间离散然后按左端点排序，假设离散后 $n$ 个区间覆盖 $[1,2n]$ 的节点。对于固定左端点 $i$ ，且先不考虑以 $[i+1,2n]$ 为左端点的区间 $u\in U-T_i$ 时，可以发现不论 $T_i$ 选取了哪些区间，在数轴 $[i,2n]$ 上的点被覆盖的次数总是单调不增的（比如对于 $T_3$ 所选的一些区间后，数轴 $[3,2n]$ 的覆盖情况可能是 $\{3,3,2,2,1,1,0,0,\dots\}$ ）。

现在仅考虑 $k=3$ 的情况（$k=2\or k=1$就比较简单，按 $k$ 分类做）。令 $f(i,j,k)$ 为：确定$T_{i-1}$的选取状态，使区间$[i,j)$被覆盖2次，$[j,k)$被覆盖一次的最大覆盖长度。

考虑转移 $f(i,j,k)$ 。枚举以 $i$ 作为左端点的区间 $S_i$ ，可知当 $S_i = [i,r_i],r_i<k$ 时对答案无贡献便跳过。剩下的 $S_i = [i,r_i],r_i\geq k$，可以采用刷表的形式转移：$dp(i,j,k) \rightarrow dp(j,k,r_i+1)$，写成等式即 $dp(j,k,r_i+1) = \max(dp(i,k,r_i+1),dp(i,j,k)+r_i-k+1)$（这里的$r_i-k+1$应计算离散前的区间长度，这里为了书写美观就不加其他对应的数组了）。另外对于$[1,i-1]$的点覆盖没有要求，故求个前缀和，即$dp(i+1,j,k) = \max(dp(i+1,j,k),dp(i,j,k))$。最后答案就为$\max\{dp(i,j,k)\}$。

固定$i$取枚举$j,k$，每次有$q$个以$i$作为左端点的区间可以转移，故复杂度为$O(\sum q*n^2) = O(n^3)$。